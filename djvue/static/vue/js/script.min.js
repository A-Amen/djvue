let nonFieldErrorsKey="non_field_errors",detailErrorKey="detail",errorKeys=[nonFieldErrorsKey,detailErrorKey],djVueMixin={delimiters:["{(",")}"],data:()=>({options:{},nonFieldErrors:[],actionURL:null,form:{},files:{},fileUploadURL:uploadURL}),mounted(){axios.options(this.actionURL).then(e=>{this.options=e.data.actions.POST})},methods:{getFieldsetRefs(){return Object.keys(this.form).filter(e=>_.isPlainObject(this.form[e]))},getFormsetRefs(){return Object.keys(this.form).filter(e=>_.isArray(this.form[e]))},getFormData(){return this.form},submit(){this.nonFieldErrors=[],axios.post(this.actionURL,Object.assign({},this.getFormData(),this.files)).then(this.success).catch(this.error)},success(e){alert("You must implemented success method.")},error(e,r="form"){if(e.response&&400===e.response.status){let s=e.response.data;this.renderFieldErrors(s,r)}else this.nonFieldErrors.push("Error! Contact an administrator.")},renderFieldErrors(e,r="form"){if(_.has(e,"detail"))this.nonFieldErrors.push(e.detail);else if(_.has(e,nonFieldErrorsKey))this.nonFieldErrors=e[nonFieldErrorsKey];else if(!_.has(e,nonFieldErrorsKey)){this.renderFieldsetErrors(e),this.renderFormsetErrors(e);let s={};Object.keys(e).forEach(r=>{!r.includes(".")&&_.isArray(e[r])&&(s[r]=e[r])}),this.$refs[r].setErrors(s)}},renderFieldsetErrors(e){this.getFieldsetRefs().forEach(r=>{if(e.hasOwnProperty(r)){let s=e[r];Object.keys(s).forEach(e=>{errorKeys.includes(e)||(s[`${r}.${e}`]=s[e],delete s[e])}),this.$refs[r].setErrors(s),this.renderFieldErrors(s,r)}})},renderFormsetErrors(e){this.getFormsetRefs().forEach(r=>{if(e.hasOwnProperty(r)){let s=e[r];s.forEach((e,s)=>{Object.keys(e).map(r=>{errorKeys.includes(r)||(e[`${r}-${s}`]=e[r],delete e[r])}),this.$refs[r].setErrors(e),this.renderFieldErrors(e,r)})}})},uploadFile(e,r,s=!1){let t=new FormData;const i=this;this.$refs.form.setErrors({[e.target.name]:[]});let o=Boolean(r)?r:this.fileUploadURL;o=`${o}?field-name=${e.target.name}`,t.append("file",e.target.files[0]),axios.post(o,t,{headers:{"Content-Type":"multipart/form-data"}}).then(({data:r})=>{if(s){let s=[];e.target.name in i.files&&(s=i.files[e.target.name]),s.push(r),Vue.set(i.files,e.target.name,s)}else Vue.set(i.files,e.target.name,r),i.$emit("uploadedFile",e)}).catch(r=>{e.target.value=null,i.error(r)})}}};